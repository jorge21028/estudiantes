<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASI: Diseño de Aplicaciones y Sistemas de Información</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="icon/icon.png">
    <style>
        /* Estilos para el formulario de acceso */
        #login-overlay {
            background: #ffffff;
            padding: 30px;
            border-radius: 12px;
            max-width: 400px;
            margin: 50px auto;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid #e1e1e1;
        }
        #login-overlay h3 { color: #333; margin-bottom: 20px; }
        #login-overlay select, #login-overlay input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box; /* Asegura que el padding no desborde el ancho */
        }
        #login-overlay button {
            background-color: #004a99;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: background 0.3s;
        }
        #login-overlay button:hover { background-color: #003366; }
        
        /* El contenido real inicia oculto */
        #contenido-real { display: none; }
        
        #loading-msg { font-size: 14px; color: #666; }
    </style>
</head>
<body>

<header class="navbar">
    <div class="navbar-content">
        <div class="logo"><a href="index.html">J. L. Abreu | Recursos Estudiantes</a></div>
        <nav>
            <ul class="nav-links">
                <li><a href="index.html">Inicio</a></li>
                <li class="dropdown">
                    <a href="#">Módulos</a>
                    <ul class="submenu">
                        <li><a href="DDBD.html">DDBD</a></li>
                        <li><a href="DPWRM.html">DPWRM</a></li>
                        <li><a href="TecDig.html">Tec.Dig</a></li>
                        <li><a href="DASI.html">DASI</a></li>
                        <li><a href="IMASI.html">IMASI</a></li>
                        <li><a href="Talleres.html">Talleres</a></li>
                    </ul>
                </li>
                <li><a href="cv_soporte.html">CV/Soporte</a></li>
            </ul>
        </nav>
    </div>
</header>

<div class="container">
    <div id="login-overlay">
        <h3>Acceso Estudiantes</h3>
        <p id="loading-msg">Conectando con la base de datos de usuarios...</p>
        
        <select id="lista-usuarios" disabled>
            <option value="">Cargando lista...</option>
        </select>
        
        <input type="password" id="pass-usuario" placeholder="Clave de acceso">
        
        <button id="btn-entrar" onclick="verificarAcceso()" disabled>Entrar al Módulo</button>
        
        <p id="error" style="color:red; font-size:13px; margin-top:15px; min-height: 1.2em;"></p>
    </div>

    <div id="contenido-real">
        <h1>DASI: Diseño de Aplicaciones y Sistemas de Información</h1>    
        <h2>Actividades DASI: Diseño de Aplicaciones y Sistemas de Información</h2>
        <div class="content-box">
            <section id="modular">
                <iframe
                  src="https://drive.google.com/embeddedfolderview?id=1EUVtAdXuA301QOsw-1Q1wWINf75GYYQ9#list"
                  style="width:100%; height:600px; border:0;">
                </iframe>
            </section>
        </div>
    </div>
</div>

<footer>
    <p>&copy; 2026 Jorge Luis Abreu Rodríguez | Portafolio Docente - C.E. Nuestra Señora de la Altagracia</p>
</footer>

<script>
    // IMPORTANTE: Pegue aquí la URL de su Google Apps Script (Implementación Web)
    const APP_URL = "https://script.google.com/macros/s/AKfycbwNrhFsZ72uHMaNMUDn-HxCscFP27ubU7s7VZ1TNxgZYyCngOwLiKQvr8g-3-ftoAZB2Q/exec";
    let baseDatos = [];

    // Función para cargar usuarios al iniciar
    async function cargarLista() {
        const select = document.getElementById('lista-usuarios');
        const btn = document.getElementById('btn-entrar');
        const loadingMsg = document.getElementById('loading-msg');

        try {
            const res = await fetch(APP_URL);
            baseDatos = await res.json();
            
            select.innerHTML = '<option value="">-- Seleccione su nombre --</option>';
            baseDatos.forEach(u => {
                let opt = document.createElement('option');
                opt.value = u.nombre;
                opt.textContent = u.nombre;
                select.appendChild(opt);
            });

            // Habilitar controles
            select.disabled = false;
            btn.disabled = false;
            loadingMsg.textContent = "Base de datos lista. Seleccione su usuario.";
            
        } catch (e) {
            console.error(e);
            document.getElementById('error').textContent = "Error de conexión. Verifique su internet.";
            loadingMsg.textContent = "Error al cargar datos.";
        }
    }

    async function verificarAcceso() {
        const nombre = document.getElementById('lista-usuarios').value;
        const clave = document.getElementById('pass-usuario').value;
        const feedback = document.getElementById('error');
        const btn = document.getElementById('btn-entrar');

        if (!nombre) {
            feedback.textContent = "Por favor, seleccione su nombre.";
            return;
        }

        // Buscar en la base de datos local (ya descargada en baseDatos)
        const usuarioValido = baseDatos.find(u => u.nombre === nombre && u.clave === clave);

        if (usuarioValido) {
            feedback.style.color = "green";
            feedback.textContent = "Acceso correcto. Registrando entrada...";
            btn.disabled = true;

            try {
                // Envío asíncrono del log al Google Sheets
                await fetch(APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nombre: nombre })
                });
            } catch (error) {
                console.warn("No se pudo registrar el log, pero el acceso es permitido.");
            }

            // Mostrar el contenido y ocultar el login
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('contenido-real').style.display = 'block';
        } else {
            feedback.style.color = "red";
            feedback.textContent = "Clave incorrecta. Intente de nuevo.";
        }
    }

    // Iniciar carga al abrir la página
    window.onload = cargarLista;
</script>

</body>
</html>
